(function(b,a){b.$$=function(){return{conf:function(){var d=location.protocol+"//"+location.hostname+":"+location.port;var c="/"+(appConfig.projectName||"");var e=d+c;return{getWebAppRoot:function(){return e}}}(),Promise:function(c){if(!c||Object.prototype.toString.call(c)!="[object Function]"){throw new Exception("传入的目标函数不是有效的函数类型。")}var d=c;return{once:function(){d()},then:function(e){if(Object.prototype.toString.call(e)!="[object Function]"){console.error("传入的回调函数不是有效的函数类型。");return}d(e)}}},loadImg:function(e,d,f){var c=new Image();c.onload=function(){e.src=this.src;if(f){f(this)}};c.src=d},autoImgSize:function(e){var f=a(e);var j=f.parent();var k=j.width();var d=j.height();var c=f.width();var g=f.height();var i=c/g;if(c-k>0){g=g*k/c;c=k}if(g-d>0){c=c*d/g;g=d}f.css({width:c+"px",height:g+"px"})}}}();$$.Map=function(){var d;function c(e,f){require(["esri/map","dojo/domReady!"],function(g){d=new g(e);if(f){f(d)}})}return{init:function(f){function e(g){c(f,g)}return new $$.Promise(e)}}}()})(window,jQuery);(function(b,a){$$.Map.BaseMapToggler=function(h){var j=h.map;var i=h.data||[];var f={};var d=a("<div class='baseMapToggler'>   <div class='baseMapInsideList'></div></div>");d.find("> .baseMapInsideList").on("click",".baseMapInside",function(){if(Object.getOwnPropertyNames(f).length<2){return}if(a(this).is("[selected='selected']")){if(a(this).is("[expand='expand']")){a(this).removeAttr("expand");g()}else{a(this).attr("expand","expand");e()}}else{var k=a(this);g(function(){var m=d.find(".baseMapInsideList > .baseMapInside[selected='selected']");if(m&&m.length>0){for(var l=0;l<m.length;l++){a(m[l]).removeAttr("expand");a(m[l]).removeAttr("selected");a(m[l]).css("display","none")}}k.css("display","");k.attr("selected","selected")})}});function g(n){var l=d.find(".baseMapInsideList > .baseMapInside");if(l){for(var m=0;m<l.length;m++){var k=a(l[m]);if(!k.is("[selected='selected']")){k.animate({left:"auto",top:0,display:"none"},150,function(){if(n){n()}})}}}}function e(o){var l=d.find(".baseMapInsideList > .baseMapInside");if(l){for(var n=0,m=0;n<l.length;n++){var k=a(l[n]);if(!k.is("[selected='selected']")){k.css("display","");k.animate({left:"auto",top:(k[0].offsetHeight+8)*(++m)},300,function(){if(o){o()}})}}}}function c(n){var l=false;if(Object.getOwnPropertyNames(f).length==0){l=true}var k;if(!l){k=a("<div class='baseMapInside' style='display: none;'></div>")}else{k=a("<div class='baseMapInside' selected='selected'></div>");if(n.onClick){n.onClick(k[0],true)}}var m=a("<img src=''>");$$.loadImg(m[0],n.icon);k.append(m);d.find(".baseMapInsideList").append(k);k.on("click",function(){if(n.onClick){n.onClick(this,!a(this).is("[selected='selected']"))}});f[n.id.toString()]=k[0];return k[0]}return{getDom:function(){return d[0]},append:function(l){var k={id:l.id,icon:l.icon,onClick:l.onClick};return c(k)}}}})(window,jQuery);(function(b,a){$$.Biz=function(){return{}}();$$.Biz.BuildingStoreyView=function(l){var j;var m=l.buildingData;var c=l.storeyData;var i={};var r;var n;var q=0;var d=-99;g();function p(y){q=1;var x=a(j).find(".backBtn")[0];a(x).show();if(!y.structChartUrl){return}var w=$$.conf.getWebAppRoot()+y.structChartUrl;var z=a(j).find(".displayImg")[0];var v=a(j).find(".descCont")[0];$$.loadImg(z,w,function(A){n=A;$$.autoImgSize(z)});a(v).html(y.remark||"此楼层尚未添加描述。")}function e(){q=0;d=-99;var z=a(j).find(".listCont button[selected='selected']");if(z&&z.length>0){for(var y=0;y<z.length;y++){a(z[y]).removeAttr("selected")}}var x=a(j).find(".backBtn")[0];a(x).hide();if(!m.structChartUrl){return}var w=$$.conf.getWebAppRoot()+m.structChartUrl;var A=a(j).find(".displayImg")[0];var v=a(j).find(".descCont")[0];$$.loadImg(A,w,function(B){n=B;$$.autoImgSize(A)});a(v).html(m.remark||"此建筑尚未添加描述。")}function g(){if(c&&c.length>0){for(var w=0;w<c.length;w++){var v=c[w];i[""+v.floorNum]=v}}k();t();f();h()}function u(A){A=parseInt(A);var v=a(j).find(".listCont")[0];a(v).empty();var y=10*A+1;for(var x=0;x<10;x++){var z="";if(parseInt(y)==parseInt(d)){z=" selected='selected'"}var w=a("<button floorNum='"+y+"'"+z+">"+y+" 层</button>");a(v).append(w);y++}}function f(){if(!c||c.length==0){return}var w=Math.ceil(c.length/10);var A=1;var x=10;var v=a(j).find(".ctrlSelect")[0];a(v).on("change",function(){u(a(v).val())});a(v).html();for(var y=0;y<w;y++){var z=a("<option value='"+y+"'>"+A+" - "+x+"</option>");a(v).append(z);A+=10;x+=10}u(0)}function k(){r=new $$.Biz.MaskLayer();r.show()}function s(w){d=w;var v=i[""+w];p(v)}function h(){var w=a(j).find(".backBtn")[0];var v=a(j).find(".listCont")[0];a(w).on("click",function(){e()});a(v).on("click","button",function(){var z=parseInt(a(this).attr("floorNum"));if(!a(this).is("[selected='selected']")){var y=a(v).find("button[selected='selected']");if(y&&y.length>0){for(var x=0;x<y.length;x++){a(y[x]).removeAttr("selected")}}a(this).attr("selected","selected");s(a(this).attr("floorNum"))}});a(window).on("resize",function(){var x=a(j).find(".displayImg")[0];if(n){a(x).css("width",n.width+"px");a(x).css("height",n.height+"px")}$$.autoImgSize(x)})}function t(){a.get({async:false,url:$$.conf.getWebAppRoot()+"/lib/app/template/buildingStoreyView.html",dataType:"text",success:function(w,x,v){j=a(w)[0];a("body").append(j);o();e()}})}function o(){var x=a(j).find(".mainCont")[0];var y=a(x).find(".topCont")[0];var w=a(j).find(".backBtn > img")[0];var v=(a(j).height()-a(x).height())/2;a(x).css("margin-top",v+"px");$$.loadImg(w,$$.conf.getWebAppRoot()+"/lib/app/image/back.png",function(z){n=z})}return{getDom:function(){return j}}};$$.Biz.MaskLayer=function(){var c=a("body");var d=c.children(".maskLayer");if(!d||d.length==0){d=a("<div class='maskLayer' style='display: none;'></div>")[0];c.append(d)}return{getDom:function(){return d},show:function(){a(d).show()},hide:function(){a(d).hide()},destroy:function(){a(d).remove()}}}})(window,jQuery);